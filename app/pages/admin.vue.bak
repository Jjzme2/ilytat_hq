<template>
    <div class="h-full flex flex-col">
        <header class="flex-none px-6 py-4 border-b border-white/10 flex justify-between items-center bg-zinc-900/50 backdrop-blur-sm sticky top-0 z-10">
            <div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-300">
                    Admin Panel
                </h1>
                <p class="text-sm text-zinc-400 mt-1">System configuration and management</p>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 scrollbar-thin">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- User Management -->
                <div class="p-6 bg-zinc-900/40 border border-white/5 rounded-xl">
                    <h3 class="text-lg font-semibold text-white mb-2">Users</h3>
                    <p class="text-sm text-zinc-400 mb-4">Manage user roles and permissions.</p>
                    <button class="px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-white rounded text-sm transition-colors">
                        Manage Users
                    </button>
                </div>

                <!-- System Settings -->
                 <div class="p-6 bg-zinc-900/40 border border-white/5 rounded-xl">
                    <h3 class="text-lg font-semibold text-white mb-2">System Settings</h3>
                    <p class="text-sm text-zinc-400 mb-4">Configure global application settings.</p>
                    <button class="px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-white rounded text-sm transition-colors">
                        Configure
                    </button>
                </div>

                 <!-- Logs -->
                 <div class="p-6 bg-zinc-900/40 border border-white/5 rounded-xl">
                    <h3 class="text-lg font-semibold text-white mb-2">Logs</h3>
                    <p class="text-sm text-zinc-400 mb-4">View system logs and activity.</p>
                    <button class="px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-white rounded text-sm transition-colors">
                        View Logs
                    </button>
                </div>
                
                <!-- System Tests -->
                <div class="p-6 bg-zinc-900/40 border border-white/5 rounded-xl col-span-1 md:col-span-2 lg:col-span-3">
                    <h3 class="text-lg font-semibold text-white mb-2">System Tests</h3>
                    <p class="text-sm text-zinc-400 mb-4">Run manual verification tests.</p>
                    <div class="flex flex-wrap gap-2">
                        <button @click="testToast('success')" class="px-3 py-1.5 bg-green-600/20 hover:bg-green-600/30 text-green-400 border border-green-600/50 rounded text-sm transition-colors">
                            Test Success Toast
                        </button>
                        <button @click="testToast('error')" class="px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-600/50 rounded text-sm transition-colors">
                            Test Error Toast
                        </button>
                        <button @click="testToast('info')" class="px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 border border-blue-600/50 rounded text-sm transition-colors">
                            Test Info Toast
                        </button>
                        <button @click="testNotification" class="px-3 py-1.5 bg-amber-600/20 hover:bg-amber-600/30 text-amber-400 border border-amber-600/50 rounded text-sm transition-colors">
                            Test Inbox Notification
                        </button>
                        <button @click="testFirestore" class="px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 text-purple-400 border border-purple-600/50 rounded text-sm transition-colors">
                            Test Firestore RW
                        </button>
                        <button @click="testEmail" class="px-3 py-1.5 bg-zinc-600/20 hover:bg-zinc-600/30 text-zinc-400 border border-zinc-600/50 rounded text-sm transition-colors">
                            Test Mock Email
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
</template>

<script setup lang="ts">

import { useFirestoreRepository } from '~/composables/useFirestoreRepository';
import { InboxMessage } from '~/models/InboxMessage';

definePageMeta({
    layout: 'default',
    middleware: ['auth'] // Ensure only admins can access (middleware needs to be robust)
});

const { success, error, info, add } = useToast();
const inboxRepo = useFirestoreRepository('messages', (data) => new InboxMessage(data));

const testToast = (type: 'success' | 'error' | 'info') => {
    const message = `This is a test ${type} toast notification.`;
    const options = { dismissible: true, duration: 3000 };
    
    switch (type) {
        case 'success': success(message, options); break;
        case 'error': error(message, options); break;
        case 'info': info(message, options); break;
    }
};

const testNotification = async () => {
    try {
        await inboxRepo.create(new InboxMessage({
            subject: 'Test Notification',
            body: 'This is a test notification generated from the Admin Panel.',
            from: 'System Admin',
            read: false,
            createdAt: new Date().toISOString()
        }));
        success('Test notification sent to Inbox.');
    } catch (e) {
        console.error(e);
        error('Failed to send notification.');
    }
};

const testFirestore = async () => {
    try {
        const testRepo = useFirestoreRepository('_tests', (d) => d);
        const doc = await testRepo.create({
             toJSON: () => ({ timestamp: new Date().toISOString(), test: true }) 
        } as any);
        success(`Firestore Write Success: ${doc.id}`);
        
        // Cleanup
        // await testRepo.remove(doc.id);
    } catch (e) {
        console.error(e);
        error('Firestore Test Failed.');
    }
};

const testEmail = () => {
    console.log('[Mock Email] Sending email to user...');
    info('Mock email logged to console.');
};
</script>
